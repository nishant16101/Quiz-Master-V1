{% extends "base.html" %}
{% block title %}Quiz Attempt{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h3>{{ quiz.title }}</h3>
                <div id="timer" class="h4 text-danger">Time remaining: <span id="time">{{ quiz.duration }}:00</span></div>
            </div>
        </div>
        <div class="card-body">
            <form method="POST" action="/submit_quiz/{{ quiz.id }}" id="quizForm">
                {% csrf_token %}
                {% for question in questions %}
                <div class="question-card mb-4">
                    <h5>Question {{ forloop.counter }}</h5>
                    <p class="question-text">{{ question.content }}</p>
                    <div class="options">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q{{ question.id }}" id="q{{ question.id }}_A" value="A" required>
                            <label class="form-check-label" for="q{{ question.id }}_A">{{ question.option_a }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q{{ question.id }}" id="q{{ question.id }}_B" value="B" required>
                            <label class="form-check-label" for="q{{ question.id }}_B">{{ question.option_b }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q{{ question.id }}" id="q{{ question.id }}_C" value="C" required>
                            <label class="form-check-label" for="q{{ question.id }}_C">{{ question.option_c }}</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q{{ question.id }}" id="q{{ question.id }}_D" value="D" required>
                            <label class="form-check-label" for="q{{ question.id }}_D">{{ question.option_d }}</label>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary">Submit Quiz</button>
            </form>
        </div>
    </div>
</div>

<script>
    function startTimer(duration) {
        let timer = duration * 60; // Convert minutes to seconds
        const display = document.querySelector('#time');
        
        const countdown = setInterval(function () {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            
            display.textContent = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            
            if (--timer < 0) {
                clearInterval(countdown);
                document.getElementById('quizForm').submit();
            }
        }, 1000);
    }
    
    window.onload = function () {
        const quizDuration = parseInt("{{ quiz.duration|default:0 }}", 10); // Safely parse duration
        if (!isNaN(quizDuration) && quizDuration > 0) {
            startTimer(quizDuration);
        } else {
            console.error('Invalid quiz duration');
        }
    };
</script>
{% endblock %}
